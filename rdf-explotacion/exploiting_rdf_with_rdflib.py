# -*- coding: utf-8 -*-
"""exploiting-rdf-with-rdflib.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/1KzwYfuVp0nINUGbajX0MvNU70u1QfzpD
"""

!pip install rdflib

storage = "https://raw.githubusercontent.com/opencitydata/guia-rdf-datosgob/main/rdf-explotacion/terrazas-madrid.nt" #poner el enlace a tus datos en github (raw files)

from rdflib import Graph, Namespace, Literal
from rdflib.plugins.sparql import prepareQuery
g = Graph()

g.parse(storage, format="ntriples") #quizá esto tarde un poco si el archivo es muy grande

"""# Consulta 1: Listado de terrazas y sus horarios de lunes a viernes anualmente"""

from rdflib import XSD

ESCOM = Namespace("http://vocab.ciudadesabiertas.es/def/comercio/tejido-comercial/") # cambiar a los namespaces que queramos nosotros

q1 = prepareQuery('''
  SELECT 
    ?terraza ?horario
	WHERE { 
    ?terraza rdf:type escom:Terraza;
          <http://schema.org/openingHours> ?horario .
    
    FILTER(regex(?horario, "Anual Lun-Juev.*", "i" ))
  } 
  ''',
  initNs = { "escom": ESCOM}
)

for r in g.query(q1):
  print(r.terraza, r.horario)



"""# Consulta 2: Listado de terrazas que tengan más de 15 mesas autorizadas"""

from rdflib import XSD

ESCOM = Namespace("http://vocab.ciudadesabiertas.es/def/comercio/tejido-comercial/") # cambiar a los namespaces que queramos nosotros

q1 = prepareQuery('''
  SELECT 
    ?terraza ?mesas
	WHERE { 
    ?terraza rdf:type escom:Terraza;
          escom:numeroMesasAutorizadas ?mesas .
    
    FILTER(?mesas > "15"^^<http://www.w3.org/2001/XMLSchema#integer>)
  } 
  ''',
  initNs = { "escom": ESCOM}
)

for r in g.query(q1):
  print(r.terraza, r.mesas)

"""# Consulta 3: Listado de terrazas con actividad en el periodo anual"""

from rdflib import XSD

ESCOM = Namespace("http://vocab.ciudadesabiertas.es/def/comercio/tejido-comercial/") # cambiar a los namespaces que queramos nosotros

q1 = prepareQuery('''
  SELECT 
    ?terraza
	WHERE { 
    ?terraza rdf:type escom:Terraza;
          escom:periodoFuncionamiento <http://vocab.linkeddata.es/datosabiertos/kos/comercio/periodo-funcionamiento/anual> .
  } 
  ''',
  initNs = { "escom": ESCOM}
)

for r in g.query(q1):
  print(r.terraza)